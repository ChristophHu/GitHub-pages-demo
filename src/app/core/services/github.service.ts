import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { BehaviorSubject, map, Observable, of, take, tap } from 'rxjs';

interface DataState {
  data      : any
  timestamp : Date | null
  loaded    : boolean
}
@Injectable({
  providedIn: 'root'
})
export class GithubService {
  apiURL = "https://api.github.com"
  username: string = 'christophhu'
  TOKEN = 'github_pat_...'
  TOKEN_ORG = 'github_pat_...'

  events$: Observable<any> = of()
  topEvents$: Observable<any> = of()

  private readonly initialState: DataState = { data: null, timestamp: null, loaded: false }

  private readonly _repos = new BehaviorSubject<DataState>(this.initialState)
  repos$: Observable<any> = this._repos.asObservable()

  private readonly _user = new BehaviorSubject<DataState>(this.initialState)
  user$: Observable<any> = this._user.asObservable()
  
  header = {
    headers: {
      // Accept: "application/vnd.github.v3.raw+json", "Content-Type": "application/json;charset=UTF-8",
      // Authorization: `token ${this.TOKEN}`,
    },
  }
  header_org = {
    headers: {
      // Accept: "application/vnd.github.v3.raw+json", "Content-Type": "application/json;charset=UTF-8",
      // Authorization: `token ${this.TOKEN_ORG}`,
    },
  }

  constructor(private http: HttpClient) {
    // this.getRepos(this.username).pipe(
    //   take(1),
    //   tap(data => console.log('repos', JSON.parse(JSON.stringify(data)))),
    //   map((data: any) => { this._repos.next({ data, timestamp: new Date(), loaded: true }); return of(data) })
    // ).subscribe()
    let reposdata = JSON.parse(JSON.stringify([  {    "id": 131506459,    "node_id": "MDEwOlJlcG9zaXRvcnkxMzE1MDY0NTk=",    "name": "adafruit_feather_m0_bluefruit_LE_connection_prepared",    "full_name": "ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared",    "private": false,    "owner": {      "login": "ChristophHu",      "id": 25291819,      "node_id": "MDQ6VXNlcjI1MjkxODE5",      "avatar_url": "https://avatars.githubusercontent.com/u/25291819?v=4",      "gravatar_id": "",      "url": "https://api.github.com/users/ChristophHu",      "html_url": "https://github.com/ChristophHu",      "followers_url": "https://api.github.com/users/ChristophHu/followers",      "following_url": "https://api.github.com/users/ChristophHu/following{/other_user}",      "gists_url": "https://api.github.com/users/ChristophHu/gists{/gist_id}",      "starred_url": "https://api.github.com/users/ChristophHu/starred{/owner}{/repo}",      "subscriptions_url": "https://api.github.com/users/ChristophHu/subscriptions",      "organizations_url": "https://api.github.com/users/ChristophHu/orgs",      "repos_url": "https://api.github.com/users/ChristophHu/repos",      "events_url": "https://api.github.com/users/ChristophHu/events{/privacy}",      "received_events_url": "https://api.github.com/users/ChristophHu/received_events",      "type": "User",      "user_view_type": "public",      "site_admin": false    },    "html_url": "https://github.com/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared",    "description": null,    "fork": false,    "url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared",    "forks_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/forks",    "keys_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/keys{/key_id}",    "collaborators_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/collaborators{/collaborator}",    "teams_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/teams",    "hooks_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/hooks",    "issue_events_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/issues/events{/number}",    "events_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/events",    "assignees_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/assignees{/user}",    "branches_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/branches{/branch}",    "tags_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/tags",    "blobs_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/git/blobs{/sha}",    "git_tags_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/git/tags{/sha}",    "git_refs_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/git/refs{/sha}",    "trees_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/git/trees{/sha}",    "statuses_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/statuses/{sha}",    "languages_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/languages",    "stargazers_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/stargazers",    "contributors_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/contributors",    "subscribers_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/subscribers",    "subscription_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/subscription",    "commits_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/commits{/sha}",    "git_commits_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/git/commits{/sha}",    "comments_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/comments{/number}",    "issue_comment_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/issues/comments{/number}",    "contents_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/contents/{+path}",    "compare_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/compare/{base}...{head}",    "merges_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/merges",    "archive_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/{archive_format}{/ref}",    "downloads_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/downloads",    "issues_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/issues{/number}",    "pulls_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/pulls{/number}",    "milestones_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/milestones{/number}",    "notifications_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/notifications{?since,all,participating}",    "labels_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/labels{/name}",    "releases_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/releases{/id}",    "deployments_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared/deployments",    "created_at": "2018-04-29T15:32:11Z",    "updated_at": "2018-05-03T15:15:28Z",    "pushed_at": "2018-05-03T08:27:22Z",    "git_url": "git://github.com/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared.git",    "ssh_url": "git@github.com:ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared.git",    "clone_url": "https://github.com/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared.git",    "svn_url": "https://github.com/ChristophHu/adafruit_feather_m0_bluefruit_LE_connection_prepared",    "homepage": null,    "size": 557,    "stargazers_count": 0,    "watchers_count": 0,    "language": "C++",    "has_issues": true,    "has_projects": true,    "has_downloads": true,    "has_wiki": true,    "has_pages": false,    "has_discussions": false,    "forks_count": 0,    "mirror_url": null,    "archived": false,    "disabled": false,    "open_issues_count": 0,    "license": null,    "allow_forking": true,    "is_template": false,    "web_commit_signoff_required": false,    "topics": [],    "visibility": "public",    "forks": 0,    "open_issues": 0,    "watchers": 0,    "default_branch": "master"  },  {    "id": 135728006,    "node_id": "MDEwOlJlcG9zaXRvcnkxMzU3MjgwMDY=",    "name": "adafruit_feather_m0_waveshare_1_45",    "full_name": "ChristophHu/adafruit_feather_m0_waveshare_1_45",    "private": false,    "owner": {      "login": "ChristophHu",      "id": 25291819,      "node_id": "MDQ6VXNlcjI1MjkxODE5",      "avatar_url": "https://avatars.githubusercontent.com/u/25291819?v=4",      "gravatar_id": "",      "url": "https://api.github.com/users/ChristophHu",      "html_url": "https://github.com/ChristophHu",      "followers_url": "https://api.github.com/users/ChristophHu/followers",      "following_url": "https://api.github.com/users/ChristophHu/following{/other_user}",      "gists_url": "https://api.github.com/users/ChristophHu/gists{/gist_id}",      "starred_url": "https://api.github.com/users/ChristophHu/starred{/owner}{/repo}",      "subscriptions_url": "https://api.github.com/users/ChristophHu/subscriptions",      "organizations_url": "https://api.github.com/users/ChristophHu/orgs",      "repos_url": "https://api.github.com/users/ChristophHu/repos",      "events_url": "https://api.github.com/users/ChristophHu/events{/privacy}",      "received_events_url": "https://api.github.com/users/ChristophHu/received_events",      "type": "User",      "user_view_type": "public",      "site_admin": false    },    "html_url": "https://github.com/ChristophHu/adafruit_feather_m0_waveshare_1_45",    "description": null,    "fork": false,    "url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45",    "forks_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/forks",    "keys_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/keys{/key_id}",    "collaborators_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/collaborators{/collaborator}",    "teams_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/teams",    "hooks_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/hooks",    "issue_events_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/issues/events{/number}",    "events_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/events",    "assignees_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/assignees{/user}",    "branches_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/branches{/branch}",    "tags_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/tags",    "blobs_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/git/blobs{/sha}",    "git_tags_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/git/tags{/sha}",    "git_refs_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/git/refs{/sha}",    "trees_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/git/trees{/sha}",    "statuses_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/statuses/{sha}",    "languages_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/languages",    "stargazers_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/stargazers",    "contributors_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/contributors",    "subscribers_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/subscribers",    "subscription_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/subscription",    "commits_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/commits{/sha}",    "git_commits_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/git/commits{/sha}",    "comments_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/comments{/number}",    "issue_comment_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/issues/comments{/number}",    "contents_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/contents/{+path}",    "compare_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/compare/{base}...{head}",    "merges_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/merges",    "archive_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/{archive_format}{/ref}",    "downloads_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/downloads",    "issues_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/issues{/number}",    "pulls_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/pulls{/number}",    "milestones_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/milestones{/number}",    "notifications_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/notifications{?since,all,participating}",    "labels_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/labels{/name}",    "releases_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/releases{/id}",    "deployments_url": "https://api.github.com/repos/ChristophHu/adafruit_feather_m0_waveshare_1_45/deployments",    "created_at": "2018-06-01T14:30:08Z",    "updated_at": "2018-06-01T14:40:37Z",    "pushed_at": "2018-06-01T14:40:36Z",    "git_url": "git://github.com/ChristophHu/adafruit_feather_m0_waveshare_1_45.git",    "ssh_url": "git@github.com:ChristophHu/adafruit_feather_m0_waveshare_1_45.git",    "clone_url": "https://github.com/ChristophHu/adafruit_feather_m0_waveshare_1_45.git",    "svn_url": "https://github.com/ChristophHu/adafruit_feather_m0_waveshare_1_45",    "homepage": null,    "size": 8,    "stargazers_count": 0,    "watchers_count": 0,    "language": "C++",    "has_issues": true,    "has_projects": true,    "has_downloads": true,    "has_wiki": true,    "has_pages": false,    "has_discussions": false,    "forks_count": 0,    "mirror_url": null,    "archived": false,    "disabled": false,    "open_issues_count": 0,    "license": null,    "allow_forking": true,    "is_template": false,    "web_commit_signoff_required": false,    "topics": [],    "visibility": "public",    "forks": 0,    "open_issues": 0,    "watchers": 0,    "default_branch": "master"  },  {    "id": 405888702,    "node_id": "MDEwOlJlcG9zaXRvcnk0MDU4ODg3MDI=",    "name": "angular",    "full_name": "ChristophHu/angular",    "private": false,    "owner": {      "login": "ChristophHu",      "id": 25291819,      "node_id": "MDQ6VXNlcjI1MjkxODE5",      "avatar_url": "https://avatars.githubusercontent.com/u/25291819?v=4",      "gravatar_id": "",      "url": "https://api.github.com/users/ChristophHu",      "html_url": "https://github.com/ChristophHu",      "followers_url": "https://api.github.com/users/ChristophHu/followers",      "following_url": "https://api.github.com/users/ChristophHu/following{/other_user}",      "gists_url": "https://api.github.com/users/ChristophHu/gists{/gist_id}",      "starred_url": "https://api.github.com/users/ChristophHu/starred{/owner}{/repo}",      "subscriptions_url": "https://api.github.com/users/ChristophHu/subscriptions",      "organizations_url": "https://api.github.com/users/ChristophHu/orgs",      "repos_url": "https://api.github.com/users/ChristophHu/repos",      "events_url": "https://api.github.com/users/ChristophHu/events{/privacy}",      "received_events_url": "https://api.github.com/users/ChristophHu/received_events",      "type": "User",      "user_view_type": "public",      "site_admin": false    },    "html_url": "https://github.com/ChristophHu/angular",    "description": null,    "fork": false,    "url": "https://api.github.com/repos/ChristophHu/angular",    "forks_url": "https://api.github.com/repos/ChristophHu/angular/forks",    "keys_url": "https://api.github.com/repos/ChristophHu/angular/keys{/key_id}",    "collaborators_url": "https://api.github.com/repos/ChristophHu/angular/collaborators{/collaborator}",    "teams_url": "https://api.github.com/repos/ChristophHu/angular/teams",    "hooks_url": "https://api.github.com/repos/ChristophHu/angular/hooks",    "issue_events_url": "https://api.github.com/repos/ChristophHu/angular/issues/events{/number}",    "events_url": "https://api.github.com/repos/ChristophHu/angular/events",    "assignees_url": "https://api.github.com/repos/ChristophHu/angular/assignees{/user}",    "branches_url": "https://api.github.com/repos/ChristophHu/angular/branches{/branch}",    "tags_url": "https://api.github.com/repos/ChristophHu/angular/tags",    "blobs_url": "https://api.github.com/repos/ChristophHu/angular/git/blobs{/sha}",    "git_tags_url": "https://api.github.com/repos/ChristophHu/angular/git/tags{/sha}",    "git_refs_url": "https://api.github.com/repos/ChristophHu/angular/git/refs{/sha}",    "trees_url": "https://api.github.com/repos/ChristophHu/angular/git/trees{/sha}",    "statuses_url": "https://api.github.com/repos/ChristophHu/angular/statuses/{sha}",    "languages_url": "https://api.github.com/repos/ChristophHu/angular/languages",    "stargazers_url": "https://api.github.com/repos/ChristophHu/angular/stargazers",    "contributors_url": "https://api.github.com/repos/ChristophHu/angular/contributors",    "subscribers_url": "https://api.github.com/repos/ChristophHu/angular/subscribers",    "subscription_url": "https://api.github.com/repos/ChristophHu/angular/subscription",    "commits_url": "https://api.github.com/repos/ChristophHu/angular/commits{/sha}",    "git_commits_url": "https://api.github.com/repos/ChristophHu/angular/git/commits{/sha}",    "comments_url": "https://api.github.com/repos/ChristophHu/angular/comments{/number}",    "issue_comment_url": "https://api.github.com/repos/ChristophHu/angular/issues/comments{/number}",    "contents_url": "https://api.github.com/repos/ChristophHu/angular/contents/{+path}",    "compare_url": "https://api.github.com/repos/ChristophHu/angular/compare/{base}...{head}",    "merges_url": "https://api.github.com/repos/ChristophHu/angular/merges",    "archive_url": "https://api.github.com/repos/ChristophHu/angular/{archive_format}{/ref}",    "downloads_url": "https://api.github.com/repos/ChristophHu/angular/downloads",    "issues_url": "https://api.github.com/repos/ChristophHu/angular/issues{/number}",    "pulls_url": "https://api.github.com/repos/ChristophHu/angular/pulls{/number}",    "milestones_url": "https://api.github.com/repos/ChristophHu/angular/milestones{/number}",    "notifications_url": "https://api.github.com/repos/ChristophHu/angular/notifications{?since,all,participating}",    "labels_url": "https://api.github.com/repos/ChristophHu/angular/labels{/name}",    "releases_url": "https://api.github.com/repos/ChristophHu/angular/releases{/id}",    "deployments_url": "https://api.github.com/repos/ChristophHu/angular/deployments",    "created_at": "2021-09-13T08:15:26Z",    "updated_at": "2022-01-07T11:57:31Z",    "pushed_at": "2022-08-25T13:54:38Z",    "git_url": "git://github.com/ChristophHu/angular.git",    "ssh_url": "git@github.com:ChristophHu/angular.git",    "clone_url": "https://github.com/ChristophHu/angular.git",    "svn_url": "https://github.com/ChristophHu/angular",    "homepage": null,    "size": 37244,    "stargazers_count": 0,    "watchers_count": 0,    "language": "TypeScript",    "has_issues": true,    "has_projects": true,    "has_downloads": true,    "has_wiki": true,    "has_pages": false,    "has_discussions": false,    "forks_count": 0,    "mirror_url": null,    "archived": false,    "disabled": false,    "open_issues_count": 0,    "license": null,    "allow_forking": true,    "is_template": false,    "web_commit_signoff_required": false,    "topics": [],    "visibility": "public",    "forks": 0,    "open_issues": 0,    "watchers": 0,    "default_branch": "master"  }]))
    this._repos.next({ data: reposdata, timestamp: new Date(), loaded: true })
    // this.getSingleUser(this.username).pipe(
    //   take(1),
    //   tap(data => console.log('user', JSON.parse(JSON.stringify(data)))),
    //   map((data: any) => { this._user.next({ data, loaded: true }); return of(data) })
    // ).subscribe()
    let userdata = JSON.parse(JSON.stringify({"login":"ChristophHu","id":25291819,"node_id":"MDQ6VXNlcjI1MjkxODE5","avatar_url":"https://avatars.githubusercontent.com/u/25291819?v=4","gravatar_id":"","url":"https://api.github.com/users/ChristophHu","html_url":"https://github.com/ChristophHu","followers_url":"https://api.github.com/users/ChristophHu/followers","following_url":"https://api.github.com/users/ChristophHu/following{/other_user}","gists_url":"https://api.github.com/users/ChristophHu/gists{/gist_id}","starred_url":"https://api.github.com/users/ChristophHu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChristophHu/subscriptions","organizations_url":"https://api.github.com/users/ChristophHu/orgs","repos_url":"https://api.github.com/users/ChristophHu/repos","events_url":"https://api.github.com/users/ChristophHu/events{/privacy}","received_events_url":"https://api.github.com/users/ChristophHu/received_events","type":"User","user_view_type":"public","site_admin":false,"name":"Christoph","company":"@nxt-codes","blog":"https://nxt.codes","location":"Berlin, DE","email":null,"hireable":null,"bio":null,"twitter_username":null,"public_repos":67,"public_gists":5,"followers":132,"following":284,"created_at":"2017-01-23T05:32:39Z","updated_at":"2024-12-23T07:08:41Z"}))
    this._user.next({ data: userdata, timestamp: new Date(), loaded: true })
  }

  

  getSingleUser(username: string) {
    return this.http.get(`${this.apiURL}/users/${username}`, this.header)
  }
  getRepo(name: string, header = this.header) {
    return this.http.get(`${this.apiURL}/repos/${name}`, this.header).pipe(take(1))
  }
  getRepos(username: string) {
    return this.http.get(`${this.apiURL}/users/${username}/repos?per_page=3`, this.header).pipe(take(1))
  }
  getEvents(username: string) {
    return this.http.get(`${this.apiURL}/users/${username}/events`, this.header).pipe(take(1))
  }
  getRecentUpdates(top: number) {
    this.events$
    .pipe(take(1))
    .subscribe(data => {
      let repos: any[] = []
      console.log('event data', data)
      if (data) {
        data.forEach((repo: any) => {
          if (repo.type == 'PushEvent') repos.push(repo.repo.name)
        })
      }
      Array.from(new Set(repos)).slice(0, top).forEach(repo => {
        this.getRepo(repo).pipe(take(1)).subscribe({
          next: data => {
            console.log('repo', data)
          },
          error: error => {
            this.getRepo(repo, this.header_org).pipe(take(1)).subscribe({
              next: data => {
                console.log('repo', data)
              },
              error: error => {
                console.error('error', error)
              }
            })
          }
        })
      })
      console.log('repos', Array.from(new Set(repos)).slice(0, top))
      this.topEvents$ = of(Array.from(new Set(repos)).slice(0, top))
    })
  }
}
